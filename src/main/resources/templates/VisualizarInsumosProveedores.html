<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Insumos y Personas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        .logout {
            text-align: center;
            margin-top: 30px;
        }
        .logout a {
            text-decoration: none;
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2em;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <h1>Lista de Insumos y Personas</h1>
    <table>
        <thead>
            <tr>
                <th>CÃ³digo Interno</th>
                <th>Nombre Insumo</th>
                <th>Valor Unitario</th>
                <th>Personas Asociadas</th>
            </tr>
        </thead>
        <tbody id="insumosTableBody">
           
        </tbody>
    </table>

    <script>
        async function fetchInsumos() {
            try {
                const insumoResponse = await fetch('/api/insumo');
                const insumos = await insumoResponse.json();

                const personaInsumoResponse = await fetch('/api/personainsumo');
                const personaInsumos = await personaInsumoResponse.json();

                // Create a map to associate personas with insumos
                const insumoMap = {};

                // Populate the map
                personaInsumos.forEach(pi => {
                    if (!insumoMap[pi.insumo.id]) {
                        insumoMap[pi.insumo.id] = {
                            insumo: pi.insumo,
                            personas: []
                        };
                    }
                    insumoMap[pi.insumo.id].personas.push(pi.persona);
                });

                const tableBody = document.getElementById('insumosTableBody');
                tableBody.innerHTML = '';

                for (const insumo of insumos) {
                    const personas = insumoMap[insumo.id] ? insumoMap[insumo.id].personas : [];
                    const personasNames = personas.map(p =>` ${p.nombre} ${p.apellido}`).join(', ');

                    // Create a new table row for each insumo
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${insumo.codInterno}</td>
                        <td>${insumo.nombreInsumo}</td>
                        <td>${insumo.valorUnit}</td>
                        <td>${personasNames || 'Ninguna'}</td>
                    `;
                    tableBody.appendChild(row);
                }
            } catch (error) {
                console.error('Error fetching insumos or persona insumos:', error);
            }
        }

        // Fetch insumos when the page loads
        document.addEventListener('DOMContentLoaded', fetchInsumos);
    </script>

<a href="logout">
    <P>SALIR</P>
  </a>

</body>
</html>